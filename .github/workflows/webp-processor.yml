jobs:
  run-batch:
    runs-on: ubuntu-latest
    
    # 强制开启所有相关权限，解决 403 问题
    permissions:
      contents: write
      actions: write
      variables: write  # 显式声明变量写权限

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # ... 中间安装步骤不变 ...

      - name: Run Task Runner
        env:
          # 关键：显式注入 GITHUB_TOKEN，gh 命令才会读取这个权限
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          # B2 配置 ...
        run: |
          mkdir -p temp
          node task/task-run.js orm-run-webp.js 10